const _0x4e55=['max','includes','isAutoMultiattack','getTokens','thr','ranged','simpleR','Failed\x20to\x20evaluate\x20damage\x20part\x20\x22','lang','rwak','_pHandleCreateChatMessage','and','altKey','_pHandleCreateChatMessage_mutExtractSimpleAttacks','error','last','midi-qol','TERMS_COUNT','rollItem','join','forEach','properties','getAbilityModNumber','pop','abilityMod','martialR','map','parts','tree','item','_pHandleCreateChatMessage_handleMeleeRangedAttacks','its','find','type','filter','name','multiattack','_pHandleCreateChatMessage_mutExtractNamedActions','settings','martialM','get','speaker','abilities','imageButtonEnabled','trim','mwak','ctrlKey','_id','text','actor','slice','\x22></div>','TITLE_LOWER_WORDS','melee','with','_getActionByLowerName','evl','undefined','description','reduce','replace','shiftKey','length','fake','toLowerCase','meanDamage','deepEquals','avg(','count','textToNumber','_onItemRoll','test','getWithoutParens','data-item-id','createChatMessage','data','isPunctuation','roll','tokens','values','isCapsFirst','items','push','dice','value','shift','simpleM','content','useSpell'];(function(_0x29b504,_0x4e55df){const _0x1caee8=function(_0x570884){while(--_0x570884){_0x29b504['push'](_0x29b504['shift']());}};_0x1caee8(++_0x4e55df);}(_0x4e55,0x6c));const _0x1cae=function(_0x29b504,_0x4e55df){_0x29b504=_0x29b504-0x0;let _0x1caee8=_0x4e55[_0x29b504];return _0x1caee8;};const _0x3c8b2b=_0x1cae;import{Config}from'./Config.js';import{LGT,Util}from'./Util.js';import{Consts}from'./Consts.js';class ActorMultiattack{static['init'](){const _0xeac1a7=_0x1cae;Hooks['on'](_0xeac1a7('0x37'),(_0x570884,_0x59544f,_0x5f1c0b)=>{this['_pHandleCreateChatMessage'](_0x570884,_0x59544f,_0x5f1c0b);});}static async[_0x3c8b2b('0x50')](_0x4f3108,_0x42b79b,_0x77e0){const _0x525b8f=_0x3c8b2b;if(!Config[_0x525b8f('0x15')](_0x525b8f('0x1e'),_0x525b8f('0x48')))return;if(_0x77e0!==game['userId'])return;const _0x5b0296=MiscUtil[_0x525b8f('0x15')](_0x4f3108,_0x525b8f('0x38'),_0x525b8f('0x16'),_0x525b8f('0x1e'));if(!_0x5b0296)return;const _0x116c4d=Actor['collection']['get'](_0x5b0296);if(!_0x116c4d)return;const _0x4670ea=$(_0x4f3108[_0x525b8f('0x38')][_0x525b8f('0x44')]||'')['attr'](_0x525b8f('0x36'));if(!_0x4670ea)return;const _0x2996a5=_0x116c4d[_0x525b8f('0x3e')][_0x525b8f('0x15')](_0x4670ea),_0x53e371=Util[_0x525b8f('0x35')](_0x2996a5[_0x525b8f('0x10')])[_0x525b8f('0x2d')]();if(_0x53e371!==_0x525b8f('0x11'))return;const _0x39a2a2=$(_0x2996a5[_0x525b8f('0x38')][_0x525b8f('0x38')][_0x525b8f('0x27')][_0x525b8f('0x41')])[_0x525b8f('0x1d')]()[_0x525b8f('0x19')]();if(!_0x39a2a2)return;const _0x55cc0c=_0x39a2a2['split'](/[.?!]/g)[_0x525b8f('0x7')](_0xd828ec=>_0xd828ec[_0x525b8f('0x19')]())[_0x525b8f('0xf')](Boolean),_0x442757=[];this[_0x525b8f('0x12')](_0x116c4d,_0x55cc0c,_0x442757),this[_0x525b8f('0x53')](_0x116c4d,_0x55cc0c,_0x442757);for(const _0x45e6cc of _0x442757){for(let _0x5c9997=0x0;_0x5c9997<_0x45e6cc[_0x525b8f('0x31')];++_0x5c9997){const _0x2b71e0={'preventDefault':()=>{},'stopPropagation':()=>{},'currentTarget':$('<div\x20class=\x22item\x22\x20data-item-id=\x22'+_0x45e6cc[_0x525b8f('0xa')][_0x525b8f('0x1c')]+_0x525b8f('0x20'))[0x0]};if(typeof BetterRolls!==_0x525b8f('0x26')){const _0x1a8125=new Event(_0x525b8f('0x2c'));_0x1a8125[_0x525b8f('0x1b')]=![],_0x1a8125[_0x525b8f('0x2a')]=![],_0x1a8125[_0x525b8f('0x52')]=![];const _0x3c11b2={'adv':0x0,'disadv':0x0,'event':_0x1a8125};!game[_0x525b8f('0x13')][_0x525b8f('0x15')]('betterrolls5e',_0x525b8f('0x18'))?_0x45e6cc[_0x525b8f('0xa')]['actor']['sheet'][_0x525b8f('0x33')](_0x2b71e0):await BetterRolls[_0x525b8f('0x58')](_0x45e6cc[_0x525b8f('0xa')],mergeObject(_0x3c11b2,{'preset':0x0}))['toMessage']();}else{if(_0x45e6cc[_0x525b8f('0xa')][_0x525b8f('0x38')]['type']==='spell')await _0x45e6cc[_0x525b8f('0xa')][_0x525b8f('0x1e')][_0x525b8f('0x45')](_0x45e6cc[_0x525b8f('0xa')],{'configureDialog':!_0x2b71e0[_0x525b8f('0x2a')]});else await _0x45e6cc['item'][_0x525b8f('0x3a')]();}if(game['modules'][_0x525b8f('0x15')](_0x525b8f('0x56'))?.['active']){if(_0x5c9997<_0x45e6cc[_0x525b8f('0x31')])await MiscUtil['pDelay'](0x14d);}}}}static[_0x3c8b2b('0x12')](_0x27e450,_0x164da4,_0x534d07){const _0x5df968=_0x3c8b2b;_0x164da4[_0x5df968('0x1')](_0x453282=>{const _0x1451f1=_0x5df968;let _0x3a57a5=Util[_0x1451f1('0x49')](_0x453282);while((Util[_0x1451f1('0x39')](_0x3a57a5[0x0])||Util[_0x1451f1('0x3d')](_0x3a57a5[0x0]))&&_0x3a57a5['length'])_0x3a57a5[_0x1451f1('0x42')]();_0x3a57a5=_0x3a57a5[_0x1451f1('0x7')](_0x339f42=>_0x339f42[_0x1451f1('0x19')]())[_0x1451f1('0xf')](Boolean);const _0x3d6097=[];let _0x559905=[],_0x499d17={};const _0x39b18c=()=>{const _0x1dffb1=_0x1451f1;if(!_0x559905[_0x1dffb1('0x2b')])return;while(_0x559905['length']){if(StrUtil[_0x1dffb1('0x21')][_0x1dffb1('0x47')](_0x559905[_0x1dffb1('0x55')]()))_0x559905[_0x1dffb1('0x4')]();else break;}_0x3d6097[_0x1dffb1('0x3f')]({'name':_0x559905[_0x1dffb1('0x0')]('\x20'),'count':_0x499d17[_0x1dffb1('0x31')]||0x1}),_0x559905=[],_0x499d17={};};for(let _0x9529cf=0x0;_0x9529cf<_0x3a57a5[_0x1451f1('0x2b')];++_0x9529cf){const _0x1132ba=_0x3a57a5[_0x9529cf];if(Util[_0x1451f1('0x3d')](_0x1132ba))_0x559905[_0x1451f1('0x3f')](_0x1132ba);else{if(_0x559905['length']&&StrUtil[_0x1451f1('0x21')][_0x1451f1('0x47')](_0x1132ba))_0x559905['push'](_0x1132ba);else{const _0x292657=Consts[_0x1451f1('0x57')][_0x1451f1('0xd')](_0x1010c4=>{const _0x1bcb5e=_0x1451f1,_0x14560c=_0x3a57a5[_0x1bcb5e('0x1f')](_0x9529cf,_0x9529cf+_0x1010c4[_0x1bcb5e('0x3b')][_0x1bcb5e('0x2b')]);return CollectionUtil[_0x1bcb5e('0x2f')](_0x1010c4[_0x1bcb5e('0x3b')],_0x14560c);});_0x559905['length']&&_0x292657&&(_0x9529cf+=_0x292657[_0x1451f1('0x3b')][_0x1451f1('0x2b')]-0x1,_0x499d17[_0x1451f1('0x31')]=_0x292657[_0x1451f1('0x31')]),_0x39b18c();}}}_0x39b18c(),_0x3d6097[_0x1451f1('0x1')](_0x5a38e0=>{const _0x5972b7=_0x1451f1,_0x4f6ec4=_0x5a38e0[_0x5972b7('0x10')][_0x5972b7('0x2d')]()[_0x5972b7('0x19')](),_0x52afd=_0x27e450[_0x5972b7('0x3e')][_0x5972b7('0xd')](_0xd290de=>Util[_0x5972b7('0x35')](_0xd290de[_0x5972b7('0x10')])['toLowerCase']()===_0x4f6ec4);if(!_0x52afd)return;_0x534d07[_0x5972b7('0x3f')]({'item':_0x52afd,'count':_0x5a38e0[_0x5972b7('0x31')]||0x1});});});}static['_pHandleCreateChatMessage_mutExtractSimpleAttacks'](_0x256475,_0x507528,_0x4acb11){_0x507528['forEach'](_0x47f2e0=>{const _0x332b28=_0x1cae;_0x47f2e0=_0x47f2e0['replace'](/(two|three|four|five|six|seven|eight) (.*?) attacks/gi,(..._0x21796e)=>{const _0x405d54=_0x1cae,_0x99822e=_0x21796e[0x1][_0x405d54('0x2d')](),_0x32d1fe=Parser['textToNumber'](_0x99822e),_0x336f2b=Util[_0x405d54('0x35')](_0x21796e[0x2])[_0x405d54('0x2d')]();if(_0x336f2b===_0x405d54('0x22')||_0x336f2b===_0x405d54('0x4b'))return this[_0x405d54('0xb')](_0x256475,_0x336f2b,_0x32d1fe,_0x4acb11),'';const _0x2617bb=_0x256475[_0x405d54('0x3e')][_0x405d54('0xd')](_0xd2eb05=>Util[_0x405d54('0x35')](_0xd2eb05['name'])[_0x405d54('0x2d')]()===_0x336f2b);if(!_0x2617bb)return _0x21796e[0x0];return _0x4acb11[_0x405d54('0x3f')]({'item':_0x2617bb,'count':_0x32d1fe}),'';}),_0x47f2e0=_0x47f2e0[_0x332b28('0x29')](/makes (two|three|four|five|six|seven|eight) attacks with its (.*? or .*?)$/gi,(..._0x1f6f29)=>{const _0x41f4b3=_0x332b28,_0x5e7419=_0x1f6f29[0x1];let _0x376819=_0x1f6f29[0x2];const _0x10827=Util[_0x41f4b3('0x49')](_0x376819);while(_0x10827[_0x41f4b3('0x2b')]){const _0x120e3f=[];for(let _0x9765ff=0x0;_0x9765ff<_0x10827[_0x41f4b3('0x2b')];++_0x9765ff){const _0x701685=_0x10827[_0x9765ff][_0x41f4b3('0x2d')]();if(_0x701685===_0x41f4b3('0x51')||_0x701685==='or'||_0x701685===_0x41f4b3('0xc')||_0x701685===_0x41f4b3('0x23')||Util[_0x41f4b3('0x39')](_0x701685)){_0x10827['shift']();break;}else _0x120e3f[_0x41f4b3('0x3f')](_0x10827[_0x41f4b3('0x42')]()),_0x9765ff--;}if(_0x120e3f[_0x41f4b3('0x2b')]){const _0x3c4152=_0x120e3f[_0x41f4b3('0x0')]('')[_0x41f4b3('0x19')](),_0xe0cca2=this[_0x41f4b3('0x24')](_0x256475,_0x3c4152);_0xe0cca2&&_0x4acb11['push']({'item':_0xe0cca2,'count':Parser[_0x41f4b3('0x32')](_0x5e7419)});}}return _0x10827[_0x41f4b3('0x0')]('')[_0x41f4b3('0x19')]();}),_0x47f2e0=_0x47f2e0[_0x332b28('0x29')](/makes (?:two|three|four|five|six|seven|eight) attacks:(.*?)$/gi,(..._0x281b22)=>{const _0x572d78=_0x332b28;let _0x61a1c6=_0x281b22[0x1],_0x47ba19=![],_0x35caa7=null;while(_0x61a1c6[_0x572d78('0x2b')]&&_0x61a1c6!==_0x35caa7){_0x35caa7=_0x61a1c6,_0x61a1c6=_0x61a1c6['replace'](/(one|two|three|four|five|six|seven|eight) with (?:its |his |her )(.*)/gi,(..._0x5b7f08)=>{const _0x559e67=_0x572d78,_0x283b01=_0x5b7f08[0x1],_0xf2220b=_0x5b7f08[0x2],_0x4c4797=[],_0x133325=Util[_0x559e67('0x49')](_0xf2220b);for(let _0x33eb8f=0x0;_0x33eb8f<_0x133325['length'];++_0x33eb8f){const _0x1c31e8=_0x133325[_0x33eb8f]['toLowerCase']();if(_0x1c31e8===_0x559e67('0x51')||_0x1c31e8==='or'||Util[_0x559e67('0x39')](_0x1c31e8)){_0x133325[_0x559e67('0x42')]();break;}else _0x4c4797['push'](_0x133325[_0x559e67('0x42')]()),_0x33eb8f--;}if(_0x4c4797[_0x559e67('0x2b')]){const _0x42bf41=_0x4c4797[_0x559e67('0x0')]('')['trim'](),_0x35c3d8=this[_0x559e67('0x24')](_0x256475,_0x42bf41);_0x35c3d8&&_0x4acb11[_0x559e67('0x3f')]({'item':_0x35c3d8,'count':Parser[_0x559e67('0x32')](_0x283b01)});}return _0x133325[_0x559e67('0x0')]('')[_0x559e67('0x19')]();});}if(_0x47ba19)return'';return _0x281b22[0x0];});});}static[_0x3c8b2b('0xb')](_0xf6dec1,_0x4bc8ce,_0xa0d01e,_0x11e42c){const _0x3e7ca8=_0x3c8b2b;let _0xf08f23;const _0x4dd31a=[],_0x2f952e=[];_0xf6dec1['items'][_0x3e7ca8('0xf')](_0x3781ba=>_0x3781ba['type']==='weapon')['forEach'](_0x392c69=>{const _0x556e9d=_0x3e7ca8,_0x4a95c9=MiscUtil['get'](_0x392c69,_0x556e9d('0x38'),'data');if(!_0x4a95c9)return;const _0x5496c3=MiscUtil['get'](_0x4a95c9,'weaponType');switch(_0x5496c3){case _0x556e9d('0x43'):case _0x556e9d('0x14'):{_0x4dd31a[_0x556e9d('0x3f')](_0x392c69);if(MiscUtil['get'](_0x4a95c9,_0x556e9d('0x2'),_0x556e9d('0x4a')))_0x2f952e['push'](_0x392c69);return;}case _0x556e9d('0x4c'):case _0x556e9d('0x6'):{_0x2f952e['push'](_0x392c69);return;}}const _0x287147=MiscUtil[_0x556e9d('0x15')](_0x4a95c9,'actionType');switch(_0x287147){case _0x556e9d('0x1a'):{_0x4dd31a['push'](_0x392c69);if(MiscUtil['get'](_0x4a95c9,_0x556e9d('0x2'),_0x556e9d('0x4a')))_0x2f952e[_0x556e9d('0x3f')](_0x392c69);return;}case _0x556e9d('0x4f'):{_0x2f952e[_0x556e9d('0x3f')](_0x392c69);return;}}const _0x2ac493=(MiscUtil[_0x556e9d('0x15')](_0x4a95c9,_0x556e9d('0x27'),'value')||'')[_0x556e9d('0x29')](/[^a-zA-Z0-9:.,()]/g,'')[_0x556e9d('0x29')](/\s+/g,'\x20')[_0x556e9d('0x19')]();if(/melee or ranged weapon attack:/i['test'](_0x2ac493))_0x4dd31a[_0x556e9d('0x3f')](_0x392c69),_0x2f952e[_0x556e9d('0x3f')](_0x392c69);else{if(/melee weapon attack:/i[_0x556e9d('0x34')](_0x2ac493))_0x4dd31a[_0x556e9d('0x3f')](_0x392c69);else/ranged weapon attack:/i['test'](_0x2ac493)&&_0x2f952e['push'](_0x392c69);}});const _0x2e9c5c=_0x4bc8ce===_0x3e7ca8('0x22')?_0x4dd31a:_0x2f952e;_0xf08f23=_0x2e9c5c[_0x3e7ca8('0x7')](_0x3f5015=>{const _0x3ca0b8=_0x3e7ca8,_0x149f28=MiscUtil[_0x3ca0b8('0x15')](_0x3f5015,_0x3ca0b8('0x38'),_0x3ca0b8('0x38'),'damage',_0x3ca0b8('0x8'));if(!_0x149f28)return null;const _0xf20671=_0x149f28[_0x3ca0b8('0x7')](_0x4814f5=>{const _0x2a2e1a=_0x3ca0b8;try{const _0x224dad=_0x4814f5[0x0][_0x2a2e1a('0x29')](/@mod/gi,()=>{const _0x422762=_0x2a2e1a,_0x4b27de=_0x3f5015[_0x422762('0x5')];if(!_0x4b27de)return 0x0;const _0x13073d=MiscUtil[_0x422762('0x15')](_0xf6dec1,'data',_0x422762('0x38'),_0x422762('0x17'),_0x422762('0x41'))||0xa;return Parser[_0x422762('0x3')](_0x13073d);}),_0x2bc82f=Renderer[_0x2a2e1a('0x40')][_0x2a2e1a('0x4e')]['getTree3'](_0x2a2e1a('0x30')+_0x224dad+')');return{'type':_0x4814f5[0x1],'meanDamage':_0x2bc82f[_0x2a2e1a('0x9')][_0x2a2e1a('0x25')]({})};}catch(_0x4cf4fa){return console[_0x2a2e1a('0x54')](...LGT,_0x2a2e1a('0x4d')+_0x4814f5[0x0]+'\x22',_0x4cf4fa),null;}})[_0x3ca0b8('0xf')](Boolean);if(!_0xf20671['length'])return null;const _0x1e8033={};_0xf20671[_0x3ca0b8('0x1')](_0x5acb8f=>_0x1e8033[_0x5acb8f[_0x3ca0b8('0xe')]]=Math[_0x3ca0b8('0x46')](_0x5acb8f['meanDamage'],_0x1e8033[_0x5acb8f[_0x3ca0b8('0xe')]]||0x0));const _0x378d65=Object[_0x3ca0b8('0x3c')](_0x1e8033)[_0x3ca0b8('0x28')]((_0x109fad,_0x4c5512)=>_0x109fad+_0x4c5512,0x0);return{'item':_0x3f5015,'meanDamage':_0x378d65};})[_0x3e7ca8('0xf')](Boolean)['sort']((_0x58bf72,_0x342075)=>SortUtil['ascSort'](_0x342075['meanDamage'],_0x58bf72[_0x3e7ca8('0x2e')]))[_0x3e7ca8('0x7')](_0x48df7e=>_0x48df7e[_0x3e7ca8('0xa')])[_0x3e7ca8('0xd')](Boolean);if(!_0xf08f23&&_0x2e9c5c[0x0])_0xf08f23=_0x2e9c5c[0x0];else{if(!_0xf08f23&&!_0x2e9c5c[0x0])return;}_0x11e42c['push']({'item':_0xf08f23,'count':_0xa0d01e});}static['_getActionByLowerName'](_0x224b02,_0x4b090a){const _0x5e8fd1=_0x3c8b2b;let _0x3f65ee=_0x224b02[_0x5e8fd1('0x3e')]['find'](_0x12b1e7=>Util[_0x5e8fd1('0x35')](_0x12b1e7[_0x5e8fd1('0x10')])[_0x5e8fd1('0x2d')]()===_0x4b090a);if(!_0x3f65ee&&_0x4b090a['endsWith']('s')){const _0x1d3381=_0x4b090a['slice'](0x0,-0x1);_0x3f65ee=_0x224b02[_0x5e8fd1('0x3e')][_0x5e8fd1('0xd')](_0xa26c50=>Util[_0x5e8fd1('0x35')](_0xa26c50[_0x5e8fd1('0x10')])[_0x5e8fd1('0x2d')]()===_0x1d3381);}return _0x3f65ee;}}export{ActorMultiattack};