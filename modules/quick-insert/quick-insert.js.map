{"version":3,"file":"quick-insert.js","sources":["../src/module/settings.ts","../src/module/searchLib.ts","../src/module/searchFilters.ts","../src/module/utils.ts","../src/module/contexts.ts","../src/module/core.ts","../src/module/filterEditor.ts","../src/module/filterList.ts","../src/module/sheetFilters.ts","../src/module/systemIntegration.ts","../src/module/tinyMCEPlugin.ts","../src/module/searchApp.ts","../src/module/indexingSettings.ts","../src/quick-insert.ts"],"sourcesContent":["const MODULE_NAME = \"quick-insert\";\nexport const SAVE_SETTINGS_REVISION = 1;\n\nexport enum settings {\n  QUICKOPEN = \"quickOpen\",\n  SEARCH_ANYWHERE_COMPAT = \"searchAnywhereCompatible\",\n  LIST_STYLE = \"listStyle\",\n  ENABLE_GLOBAL_CONTEXT = \"enableGlobalContext\",\n  CLICK_TO_INSERT = \"clickToInsert\",\n  INDEXING_DISABLED = \"indexingDisabled\",\n  FILTERS_CLIENT = \"filtersClient\",\n  FILTERS_WORLD = \"filtersWorld\",\n  FILTERS_SHEETS = \"filtersSheets\",\n  FILTERS_SHEETS_ENABLED = \"filtersSheetsEnabled\",\n  GM_ONLY = \"gmOnly\",\n  INDEX_GUARD_ENABLED = \"indexGuardEnabled\",\n  INDEX_DEFERRED_DELAY = \"indexDeferredDelay\",\n}\n\ntype Callback = (value) => void;\n\nconst noop = (): void => {\n  return;\n};\n\nconst moduleSettings = [\n  {\n    setting: settings.GM_ONLY,\n    name: \"QUICKINSERT.SettingsGmOnly\",\n    hint: \"QUICKINSERT.SettingsGmOnlyHint\",\n    type: Boolean,\n    default: false,\n    scope: \"world\",\n  },\n  {\n    setting: settings.FILTERS_SHEETS_ENABLED,\n    name: \"QUICKINSERT.SettingsFiltersSheetsEnabled\",\n    hint: \"QUICKINSERT.SettingsFiltersSheetsEnabledHint\",\n    type: Boolean,\n    default: true,\n    scope: \"world\",\n  },\n  {\n    setting: settings.INDEX_GUARD_ENABLED,\n    name: \"QUICKINSERT.SettingsIndexGuardEnabled\",\n    hint: \"QUICKINSERT.SettingsIndexGuardEnabledHint\",\n    type: Boolean,\n    default: false,\n    scope: \"world\",\n  },\n  {\n    setting: settings.INDEX_DEFERRED_DELAY,\n    name: \"QUICKINSERT.SettingsIndexDeferredDelay\",\n    hint: \"QUICKINSERT.SettingsIndexDeferredDelayHint\",\n    type: Number,\n    choices: {\n      0: \"QUICKINSERT.SettingsIndexDeferredDelayImmediate\",\n      500: \"QUICKINSERT.SettingsIndexDeferredDelay05s\",\n      1000: \"QUICKINSERT.SettingsIndexDeferredDelay1s\",\n      2000: \"QUICKINSERT.SettingsIndexDeferredDelay2s\",\n      \"-1\": \"QUICKINSERT.SettingsIndexDeferredDelayOnFirstOpen\",\n    },\n    default: 1000,\n    scope: \"world\",\n  },\n  {\n    setting: settings.QUICKOPEN,\n    name: \"QUICKINSERT.SettingsQuickOpen\",\n    hint: \"QUICKINSERT.SettingsQuickOpenHint\",\n    type: window.Azzu.SettingsTypes.KeyBinding,\n    default: \"Ctrl +  \",\n  },\n  {\n    setting: settings.ENABLE_GLOBAL_CONTEXT,\n    name: \"QUICKINSERT.SettingsEnableGlobalContext\",\n    hint: \"QUICKINSERT.SettingsEnableGlobalContextHint\",\n    type: Boolean,\n    default: true,\n  },\n  {\n    setting: settings.CLICK_TO_INSERT,\n    name: \"QUICKINSERT.SettingsClickToInsert\",\n    hint: \"QUICKINSERT.SettingsClickToInsertHint\",\n    type: Boolean,\n    default: true,\n  },\n  {\n    setting: settings.INDEXING_DISABLED,\n    name: \"Things that have indexing disabled\",\n    type: Object,\n    default: {\n      entities: {\n        Macro: [1, 2],\n        Scene: [1, 2],\n        Playlist: [1, 2],\n        RollTable: [1, 2],\n      },\n      packs: {},\n    },\n    scope: \"world\",\n    config: false, // Doesn't show up in config\n  },\n  {\n    setting: settings.FILTERS_CLIENT,\n    name: \"Own filters\",\n    type: Object,\n    default: {\n      saveRev: SAVE_SETTINGS_REVISION,\n      disabled: [],\n      filters: [],\n    },\n    config: false, // Doesn't show up in config\n  },\n  {\n    setting: settings.FILTERS_WORLD,\n    name: \"World filters\",\n    type: Object,\n    default: {\n      saveRev: SAVE_SETTINGS_REVISION,\n      filters: [],\n    },\n    scope: \"world\",\n    config: false, // Doesn't show up in config\n  },\n  {\n    setting: settings.FILTERS_SHEETS,\n    name: \"Sheet filters\",\n    type: Object,\n    default: {},\n    scope: \"world\",\n    config: false, // Doesn't show up in config\n  },\n];\n\nfunction registerSetting(callback: Callback, { setting, ...options }): void {\n  game.settings.register(MODULE_NAME, setting, {\n    config: true,\n    scope: \"client\",\n    ...options,\n    onChange: callback || noop,\n  });\n}\n\nexport function registerSettings(\n  callbacks: {\n    [setting: string]: Callback;\n  } = {}\n): void {\n  moduleSettings.forEach(item => {\n    registerSetting(callbacks[item.setting], item);\n  });\n}\n\nexport function getSetting(setting: settings | string): any {\n  return game.settings.get(MODULE_NAME, setting as string);\n}\n\nexport function setSetting(setting: settings | string, value): Promise<any> {\n  return game.settings.set(MODULE_NAME, setting as string, value);\n}\n\nexport function registerMenu({ menu, ...options }): void {\n  game.settings.registerMenu(MODULE_NAME, menu, options);\n}\n","import Fuse from \"fuse.js\";\nimport { settings, getSetting } from \"./settings\";\n\nexport enum EntityType {\n  ACTOR = \"Actor\",\n  ITEM = \"Item\",\n  JOURNALENTRY = \"JournalEntry\",\n  MACRO = \"Macro\",\n  PLAYLIST = \"Playlist\",\n  ROLLTABLE = \"RollTable\",\n  SCENE = \"Scene\",\n  USER = \"User\",\n  FOLDER = \"Folder\",\n}\n\nexport const IndexedEntityTypes = [\n  EntityType.ACTOR,\n  EntityType.ITEM,\n  EntityType.JOURNALENTRY,\n  EntityType.MACRO,\n  // EntityType.PLAYLIST, // TODO: Play on selection? Open sidebar?\n  EntityType.ROLLTABLE,\n  EntityType.SCENE,\n  // EntityType.USER,\n];\n\nexport const EntityCollections = {\n  [EntityType.ACTOR]: \"actors\",\n  [EntityType.ITEM]: \"items\",\n  [EntityType.JOURNALENTRY]: \"journal\",\n  [EntityType.MACRO]: \"macros\",\n  [EntityType.PLAYLIST]: \"playlists\",\n  [EntityType.ROLLTABLE]: \"tables\",\n  [EntityType.SCENE]: \"scenes\",\n  [EntityType.USER]: \"users\",\n};\n\nexport function enabledEntityTypes(): EntityType[] {\n  const disabled = getSetting(settings.INDEXING_DISABLED);\n  return IndexedEntityTypes.filter(\n    t =>\n      //@ts-ignore\n      !disabled?.entities?.[t]?.includes(game.user.role)\n  );\n}\n\nexport function packEnabled(pack): boolean {\n  const disabled = getSetting(settings.INDEXING_DISABLED);\n  // Pack entity type enabled?\n  //@ts-ignore\n  if (disabled?.entities?.[pack.entity]?.includes(game.user.role)) {\n    return false;\n  }\n\n  // Pack enabled?\n  //@ts-ignore\n  if (disabled?.packs?.[pack.collection]?.includes(game.user.role)) {\n    return false;\n  }\n\n  // Not hidden?\n  return !(pack.private && !game.user.isGM);\n}\n\nconst entityIcons = {\n  Actor: \"fa-user\",\n  Item: \"fa-suitcase\",\n  JournalEntry: \"fa-book-open\",\n  Macro: \"\",\n  Playlist: \"fa-music\",\n  RollTable: \"fa-th-list\",\n  Scene: \"fa-map\",\n  User: \"fa-users\",\n};\n\nexport type SearchResultPredicate = (item: SearchResult) => boolean;\n\nexport class SearchItem {\n  name: string;\n  id: string;\n  img: string;\n  entityType: EntityType;\n\n  constructor(id: string, name: string, img?: string) {\n    this.id = id;\n    this.name = name;\n    this.img = img;\n  }\n\n  // Get the uuid value compatible with fromUuid\n  get uuid(): string {\n    return \"\";\n  }\n  // Get the draggable attributes in order to make custom elements\n  get draggableAttrs(): string {\n    return \"\";\n  }\n  // Get the html for an icon that represents the item\n  get icon(): string {\n    return \"\";\n  }\n  // Get a clickable (preferrably draggable) link to the entity\n  get link(): string {\n    return \"\";\n  }\n  // Reference the entity in a journal, chat or other places that support it\n  get journalLink(): string {\n    return \"\";\n  }\n  // Reference the entity in a script\n  get script(): string {\n    return \"\";\n  }\n  // Short tagline that explains where/what this is\n  get tagline(): string {\n    return \"\";\n  }\n  // Show the sheet or equivalent of this search result\n  async show(): Promise<void> {\n    return;\n  }\n\n  // Fetch the original object (or null if no longer available).\n  // NEVER call as part of indexing or filtering.\n  // It can be slow and most calls will cause a request to the database!\n  // Call it once a decision is made, do not call for every SearchItem!\n  async get(): Promise<any> {\n    return null;\n  }\n}\n\nexport class EntitySearchItem extends SearchItem {\n  folder?: { id: string; name: string };\n\n  static fromEntities(entities: Entity[]): EntitySearchItem[] {\n    return entities\n      .filter(e => e.visible)\n      .map(entity => new EntitySearchItem(entity));\n  }\n\n  get uuid(): string {\n    return `${this.entityType}.${this.id}`;\n  }\n\n  // Get the draggable attributes in order to make custom elements\n  get draggableAttrs(): string {\n    return `draggable=\"true\" data-entity=\"${this.entityType}\" data-id=\"${this.id}\"`;\n  }\n\n  get icon(): string {\n    return `<i class=\"fas ${entityIcons[this.entityType]}\"></i>`;\n  }\n\n  // Get a draggable and clickable link to the entity\n  get link(): string {\n    return `<a class=\"entity-link\" ${this.draggableAttrs}>${this.icon} ${this.name}</a>`;\n  }\n\n  // Reference the entity in a journal, chat or other places that support it\n  get journalLink(): string {\n    return `@${this.entityType}[${this.id}]{${this.name}}`;\n  }\n\n  // Reference the entity in a script\n  get script(): string {\n    return `game.${EntityCollections[this.entityType]}.get(\"${this.id}\")`;\n  }\n\n  // Short tagline that explains where/what this is\n  get tagline(): string {\n    if (this.folder) {\n      return `${this.folder.name} - ${this.entityType}`;\n    }\n    return `${this.entityType}`;\n  }\n\n  async show(): Promise<void> {\n    (await this.get())?.sheet.render(true);\n  }\n\n  async get(): Promise<Entity> {\n    return game[EntityCollections[this.entityType]].get(this.id);\n  }\n\n  constructor(entity: Entity) {\n    super(entity.id, entity.name, entity.data[\"img\"]);\n\n    const folder = entity.folder;\n    if (folder) {\n      this.folder = {\n        id: folder.id,\n        name: folder.name,\n      };\n    }\n\n    this.entityType = (entity.entity as unknown) as EntityType;\n  }\n}\n\nexport class CompendiumSearchItem extends SearchItem {\n  label: string;\n  package: string;\n  packageName: string;\n\n  static fromCompendium(compendium: Compendium): CompendiumSearchItem[] {\n    const cIndex = compendium.index as any[];\n    return cIndex.map(\n      (item: CompendiumIndexItem) => new CompendiumSearchItem(compendium, item)\n    );\n  }\n\n  constructor(pack: Compendium, item: CompendiumIndexItem) {\n    super(item.id || item._id, item.name, item.img);\n    this.package = pack.collection;\n    this.packageName = pack?.metadata?.label || pack.title;\n    this.entityType = pack.entity as EntityType;\n  }\n\n  get uuid(): string {\n    return `Compendium.${this.package}.${this.id}`;\n  }\n\n  // Get the draggable attributes in order to make custom elements\n  get draggableAttrs(): string {\n    // data-id is kept for pre-5.5 compat\n    return `draggable=\"true\" data-pack=\"${this.package}\" data-id=\"${this.id}\" data-lookup=\"${this.id}\"`;\n  }\n\n  get icon(): string {\n    return `<i class=\"fas ${entityIcons[this.entityType]}\"></i>`;\n  }\n\n  // Get a draggable and clickable link to the entity\n  get link(): string {\n    return `<a class=\"entity-link\" ${this.draggableAttrs}>${this.icon} ${this.name}</a>`;\n  }\n\n  // Reference the entity in a journal, chat or other places that support it\n  get journalLink(): string {\n    return `@Compendium[${this.package}.${this.id}]{${this.name}}`;\n  }\n\n  // Reference the entity in a script\n  get script(): string {\n    return `fromUuid(\"${this.uuid}\")`; // TODO: note that this is async somehow?\n  }\n\n  // Short tagline that explains where/what this is\n  get tagline(): string {\n    return `${this.packageName}`;\n  }\n\n  async show(): Promise<void> {\n    (await this.get())?.sheet.render(true);\n  }\n\n  async get(): Promise<Entity> {\n    return await fromUuid(this.uuid);\n  }\n}\n\nexport function isEntity(item: SearchItem): item is EntitySearchItem {\n  return item.constructor.name === \"EntitySearchItem\";\n}\nexport function isCompendiumEntity(\n  item: SearchItem\n): item is CompendiumSearchItem {\n  return item.constructor.name === \"CompendiumSearchItem\";\n}\n\nexport interface SearchResult {\n  item: SearchItem;\n  match;\n}\n\nclass FuseSearchIndex {\n  fuse: Fuse<SearchItem>;\n\n  constructor() {\n    this.fuse = new Fuse([], {\n      keys: [\"name\"],\n      includeMatches: true,\n      threshold: 0.3,\n    });\n  }\n\n  addAll(items: SearchItem[]) {\n    for (const item of items) {\n      this.fuse.add(item);\n    }\n  }\n\n  add(item: SearchItem): void {\n    this.fuse.add(item);\n  }\n\n  removeByUuid(uuid: string): void {\n    this.fuse.remove(i => i?.uuid == uuid);\n  }\n\n  search(query: string): SearchResult[] {\n    return this.fuse\n      .search(query)\n      .map(res => ({ item: res.item, match: res.matches }));\n  }\n}\n\nexport class SearchLib {\n  index: FuseSearchIndex;\n\n  constructor() {\n    this.index = new FuseSearchIndex();\n  }\n\n  indexCompendiums(): void {\n    for (const pack of game.packs as any) {\n      if (packEnabled(pack)) {\n        const index = CompendiumSearchItem.fromCompendium(pack);\n        this.index.addAll(index);\n      }\n    }\n  }\n\n  indexDefaults(): void {\n    for (const type of enabledEntityTypes()) {\n      const coll = EntityCollections[type];\n      this.index.addAll(EntitySearchItem.fromEntities(game[coll].entities));\n    }\n  }\n\n  addItem(item: SearchItem): void {\n    this.index.add(item);\n  }\n\n  removeItem(entityUuid: string): void {\n    this.index.removeByUuid(entityUuid);\n  }\n\n  replaceItem(item: SearchItem): void {\n    this.removeItem(item.uuid);\n    this.addItem(item);\n  }\n\n  search(\n    text: string,\n    filter: SearchResultPredicate,\n    max: number\n  ): SearchResult[] {\n    if (filter) {\n      return this.index.search(text).filter(filter).slice(0, max);\n    }\n    return this.index.search(text).slice(0, max);\n  }\n}\n\nexport function formatMatch(\n  result: SearchResult,\n  formatFn: (string) => string\n): string {\n  const match = result.match[0];\n  let text = match.value;\n  [...match.indices].reverse().forEach(([start, end]) => {\n    // if (start === end) return;\n    text =\n      text.substring(0, start) +\n      formatFn(text.substring(start, end + 1)) +\n      text.substring(end + 1);\n  });\n  return text;\n}\n","import {\n  enabledEntityTypes,\n  EntityCollections,\n  isEntity,\n  isCompendiumEntity,\n  SearchResult,\n  packEnabled,\n} from \"./searchLib\";\nimport { setSetting, settings, getSetting } from \"./settings\";\n\nexport interface SearchFilterConfig {\n  compendiums: string[] | \"any\";\n  folders: string[] | \"any\";\n  entities: string[] | \"any\";\n}\n\nexport enum FilterType {\n  Default,\n  World,\n  Client,\n}\n\ninterface WorldSavedFilters {\n  filters: SearchFilter[];\n}\n\ninterface ClientSavedFilters {\n  disabled: string[];\n  filters: SearchFilter[];\n}\n\nexport interface SearchFilter {\n  id: string;\n  type: FilterType;\n  tag: string; // used with @tag\n  subTitle: string; // Title\n  filterConfig?: SearchFilterConfig;\n  disabled?: boolean;\n}\n\nexport class SearchFilterCollection {\n  disabled: string[] = [];\n  dirty = true;\n\n  defaultFilters: SearchFilter[] = [];\n  clientFilters: SearchFilter[] = [];\n  worldFilters: SearchFilter[] = [];\n  combinedFilters: SearchFilter[] = [];\n\n  public get filters(): SearchFilter[] {\n    if (this.dirty) {\n      this.combinedFilters = [\n        ...this.defaultFilters,\n        ...this.worldFilters,\n        ...this.clientFilters,\n      ];\n      this.combinedFilters.forEach(\n        f => (f.disabled = this.disabled.includes(f.id))\n      );\n      this.dirty = false;\n    }\n    return this.combinedFilters;\n  }\n\n  // Someone changed the filters, will be saved etc.\n  filtersChanged(which?: FilterType): void {\n    if (which === FilterType.Client) {\n      this.saveClient();\n    } else if (which === FilterType.World) {\n      this.saveWorld();\n    } else {\n      this.save();\n    }\n  }\n\n  search(query?: string): SearchFilter[] {\n    if (!query) {\n      return [...this.filters];\n    }\n    return this.filters.filter(f => f.tag.includes(query));\n  }\n\n  getFilter(id: string): SearchFilter {\n    return this.filters.find(f => f.id == id);\n  }\n\n  getFilterByTag(tag: string): SearchFilter {\n    return this.filters.filter(f => !f.disabled).find(f => f.tag == tag);\n  }\n\n  addFilter(filter: SearchFilter): void {\n    if (filter.type == FilterType.World) {\n      this.worldFilters.push(filter);\n      this.filtersChanged(filter.type);\n    } else if (filter.type == FilterType.Client) {\n      this.clientFilters.push(filter);\n      this.filtersChanged(filter.type);\n    }\n  }\n\n  deleteFilter(id: string): void {\n    const f = this.filters.find(f => f.id === id);\n    if (f.type == FilterType.World) {\n      const x = this.worldFilters.findIndex(f => f.id === id);\n      if (x != -1) {\n        this.worldFilters.splice(x, 1);\n      }\n    } else if (f.type == FilterType.Client) {\n      const x = this.clientFilters.findIndex(f => f.id === id);\n      if (x != -1) {\n        this.clientFilters.splice(x, 1);\n      }\n    }\n    this.filtersChanged(f.type);\n  }\n\n  resetFilters(): void {\n    this.defaultFilters = [];\n    this.clientFilters = [];\n    this.worldFilters = [];\n    this.combinedFilters = [];\n    this.dirty = false;\n  }\n\n  loadDefaultFilters(): void {\n    this.loadCompendiumFilters();\n    // this.loadDirectoryFilters();\n    this.loadEntityFilters();\n    this.dirty = true;\n  }\n\n  loadEntityFilters(): void {\n    this.defaultFilters = this.defaultFilters.concat(\n      enabledEntityTypes().map(type => {\n        return {\n          id: EntityCollections[type],\n          type: FilterType.Default,\n          tag: EntityCollections[type],\n          subTitle: `${game.i18n.localize(\n            `ENTITY.${game[EntityCollections[type]].entity}`\n          )}`,\n          filterConfig: {\n            folders: \"any\",\n            compendiums: \"any\",\n            entities: [game[EntityCollections[type]].entity],\n          },\n        };\n      })\n    );\n  }\n\n  loadDirectoryFilters(): void {\n    // TODO: find a way to find directories that the user is allowed to see\n    if (!game.user.isGM) return;\n\n    this.defaultFilters = this.defaultFilters.concat(\n      enabledEntityTypes().map(type => {\n        return {\n          id: `dir.${EntityCollections[type]}`,\n          type: FilterType.Default,\n          tag: `dir.${EntityCollections[type]}`,\n          subTitle: game[EntityCollections[type]].directory?.title,\n          filterConfig: {\n            folders: \"any\",\n            compendiums: [],\n            entities: [game[EntityCollections[type]].entity],\n          },\n        };\n      })\n    );\n  }\n\n  loadCompendiumFilters(): void {\n    this.defaultFilters = this.defaultFilters.concat(\n      game.packs\n        .map(pack => {\n          if (!packEnabled(pack)) return null;\n          return {\n            id: pack.collection,\n            type: FilterType.Default,\n            tag: pack.collection,\n            subTitle: pack.metadata.label,\n            filterConfig: {\n              folders: [],\n              compendiums: [pack.collection],\n              entities: \"any\",\n            },\n          };\n        })\n        .filter(f => f != null)\n    );\n  }\n\n  loadClientSave(): void {\n    const clientSave: ClientSavedFilters = getSetting(settings.FILTERS_CLIENT);\n    this.disabled = clientSave.disabled || [];\n    this.clientFilters = clientSave.filters || [];\n    this.dirty = true;\n  }\n\n  loadWorldSave(): void {\n    const worldSave: WorldSavedFilters = getSetting(settings.FILTERS_WORLD);\n    this.worldFilters = worldSave.filters || [];\n    this.dirty = true;\n  }\n\n  loadSave(): void {\n    this.loadClientSave();\n    this.loadWorldSave();\n    Hooks.call(\"QuickInsert:FiltersUpdated\");\n  }\n\n  saveWorld(): void {\n    if (!game.user.isGM) return;\n\n    const worldSave: WorldSavedFilters = {\n      filters: [],\n    };\n\n    for (const filter of this.worldFilters) {\n      delete filter.disabled;\n      worldSave.filters.push(filter);\n    }\n\n    setSetting(settings.FILTERS_WORLD, worldSave);\n  }\n\n  saveClient(): void {\n    const clientSave: ClientSavedFilters = {\n      disabled: [],\n      filters: [],\n    };\n\n    for (const filter of [\n      ...this.defaultFilters,\n      ...this.worldFilters,\n      ...this.clientFilters,\n    ]) {\n      if (filter.disabled) {\n        clientSave.disabled.push(filter.id);\n      }\n      if (filter.type === FilterType.Client) {\n        clientSave.filters.push(filter);\n      }\n    }\n    setSetting(settings.FILTERS_CLIENT, clientSave);\n  }\n\n  save(): void {\n    this.saveClient();\n    this.saveWorld();\n  }\n}\n\n// Is parentFolder inside targetFolder?\nfunction isInFolder(parentFolder: string, targetFolder: string): boolean {\n  while (parentFolder) {\n    if (parentFolder === targetFolder) return true;\n    parentFolder = (game.folders.get(parentFolder)?.data as any).parent;\n  }\n  return false;\n}\n\nexport function matchFilterConfig(\n  config: SearchFilterConfig,\n  item: SearchResult\n): boolean {\n  let folderMatch = false;\n  let compendiumMatch = false;\n  let entityMatch = true;\n\n  if (isEntity(item.item)) {\n    if (config.folders === \"any\") {\n      folderMatch = true;\n    } else {\n      for (const f of config.folders) {\n        if (isInFolder(item.item.folder?.id, f)) {\n          folderMatch = true;\n          break;\n        }\n      }\n    }\n  } else if (isCompendiumEntity(item.item)) {\n    if (config.compendiums == \"any\") {\n      compendiumMatch = true;\n    } else {\n      compendiumMatch = config.compendiums.includes(item.item.package);\n    }\n  }\n\n  if (config.entities == \"any\") {\n    entityMatch = true;\n  } else {\n    entityMatch = config.entities.includes(item.item.entityType);\n  }\n\n  return (folderMatch || compendiumMatch) && entityMatch;\n}\n","export const i18n = (\n  name: string,\n  replacements?: { [key: string]: string }\n): string => {\n  if (replacements) {\n    return game.i18n.format(`QUICKINSERT.${name}`, replacements);\n  }\n  return game.i18n.localize(`QUICKINSERT.${name}`);\n};\n\n// Type utils\nexport type TextInputElement = HTMLInputElement | HTMLTextAreaElement;\nexport function isTextInputElement(\n  element: Element\n): element is TextInputElement {\n  return (\n    element.tagName == \"TEXTAREA\" ||\n    (element.tagName == \"INPUT\" && (element as HTMLInputElement).type == \"text\")\n  );\n}\n\n// General utils\n\nconst ALPHA = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\";\nexport function randomId(idLength = 10): string {\n  const values = new Uint8Array(idLength);\n  window.crypto.getRandomValues(values);\n  return String.fromCharCode(\n    ...values.map(x => ALPHA.charCodeAt(x % ALPHA.length))\n  );\n}\n\n// Some black magic from the internet,\n// places caret at end of contenteditable\nexport function placeCaretAtEnd(el: HTMLElement): void {\n  el.focus();\n  const range = document.createRange();\n  range.selectNodeContents(el);\n  range.collapse(false);\n  const sel = window.getSelection();\n  sel.removeAllRanges();\n  sel.addRange(range);\n}\n\n// Simple utility function for async waiting\n// Nicer to await waitFor(100) than nesting setTimeout callback hell\nexport function resolveAfter(msec: number): Promise<void> {\n  return new Promise(res => setTimeout(res, msec));\n}\n\nexport class TimeoutError extends Error {\n  constructor(timeoutMsec: number) {\n    super(`did not complete within ${timeoutMsec}ms`);\n  }\n}\n\nexport function withDeadline<T>(\n  p: Promise<T>,\n  timeoutMsec: number\n): Promise<T> {\n  return Promise.race([\n    p,\n    new Promise<T>((res, rej) =>\n      setTimeout(() => rej(new TimeoutError(timeoutMsec)), timeoutMsec)\n    ),\n  ]);\n}\n\nexport function permissionListEq(a: any[], b: any[]): boolean {\n  return a.length === b.length && [...a].every(value => b.includes(value));\n}\n","import {\n  SearchItem,\n  isEntity,\n  isCompendiumEntity,\n  EntityType,\n} from \"./searchLib\";\nimport { isTextInputElement, TextInputElement } from \"./utils\";\nimport { SearchFilter } from \"./searchFilters\";\nimport { settings, getSetting } from \"./settings\";\n\ndeclare let ui: { windows: Application[] };\n\nexport class SearchContext {\n  spawnCSS?: any = {};\n  classes?: [];\n  filter?: string | SearchFilter;\n  startText?: string;\n  allowMultiple? = true;\n  restrictTypes?: EntityType[];\n  onSubmit(item: SearchItem): void {\n    // Render the sheet for selected item\n    item.show();\n  }\n  onClose(): void {\n    return;\n  }\n}\n\nexport class InputContext extends SearchContext {\n  input: TextInputElement;\n  selectionStart: number;\n  selectionEnd: number;\n\n  constructor(input: TextInputElement) {\n    super();\n    this.input = input;\n    const targetRect = input.getBoundingClientRect();\n    const bodyRect = document.body.getBoundingClientRect();\n    const top = targetRect.top - bodyRect.top;\n    // TODO: Real calculation!!!\n    this.spawnCSS = {\n      left: targetRect.left + 5,\n      bottom: bodyRect.height - top - 30,\n      width: targetRect.width - 10,\n    };\n    this.selectionStart = input.selectionStart;\n    this.selectionEnd = input.selectionEnd;\n    if (this.selectionStart != this.selectionEnd) {\n      this.startText = this.input.value.slice(\n        this.selectionStart,\n        this.selectionEnd\n      );\n    }\n\n    $(input).addClass(\"quick-insert-context\");\n  }\n  insertResult(result: string): void {\n    this.input.value =\n      this.input.value.slice(0, this.selectionStart) +\n      result +\n      this.input.value.slice(this.selectionEnd);\n  }\n  onSubmit(item: SearchItem): void {\n    this.insertResult(item.journalLink);\n  }\n  onClose(): void {\n    $(this.input).removeClass(\"quick-insert-context\");\n    this.input.focus();\n  }\n}\n\nexport class ScriptMacroContext extends InputContext {\n  onSubmit(item: SearchItem): void {\n    this.insertResult(item.script);\n  }\n}\n\nexport class RollTableContext extends InputContext {\n  allowMultiple = false;\n  constructor(input: TextInputElement) {\n    super(input);\n    // Set filter depending on selected dropdown!\n    // const resultRow = this.input.closest(\"li.table-result\")\n  }\n  onSubmit(item: SearchItem): void {\n    const row = $(this.input).closest(\".table-result\");\n    const resultId = row.data(\"result-id\");\n    const appId = row.closest(\".window-app\").data(\"appid\");\n    const app = ui.windows[parseInt(appId)] as BaseEntitySheet;\n\n    if (isEntity(item)) {\n      app.object.updateEmbeddedEntity(\"TableResult\", [\n        {\n          _id: resultId,\n          collection: item.entityType,\n          type: 1,\n          resultId: item.id,\n          text: item.name,\n          img: item.img || null,\n        },\n      ]);\n    } else if (isCompendiumEntity(item)) {\n      app.object.updateEmbeddedEntity(\"TableResult\", [\n        {\n          _id: resultId,\n          collection: item.package,\n          type: 2,\n          resultId: item.id,\n          text: item.name,\n          img: item.img || null,\n        },\n      ]);\n    }\n  }\n}\n\nexport class TinyMCEContext extends SearchContext {\n  editor: TinyMce;\n  constructor(editor: TinyMce) {\n    super();\n\n    const targetRect = editor.selection.getBoundingClientRect();\n    const bodyRect = document.body.getBoundingClientRect();\n    const containerRect = editor.contentAreaContainer.getBoundingClientRect();\n    const top = containerRect.top + targetRect.top;\n\n    this.spawnCSS = {\n      left: containerRect.left + targetRect.left,\n      bottom: bodyRect.height - top - 20,\n      width: targetRect.width,\n      maxHeight: top + 20,\n    };\n    this.editor = editor;\n  }\n  onSubmit(item: SearchItem): void {\n    this.editor.insertContent(item.journalLink);\n  }\n  onClose(): void {\n    this.editor.focus();\n  }\n}\n\nexport class CharacterSheetContext extends SearchContext {\n  entitySheet: BaseEntitySheet;\n  anchor: JQuery<HTMLElement>;\n\n  restrictTypes = [EntityType.ITEM];\n\n  constructor(entitySheet: BaseEntitySheet, anchor: JQuery<HTMLElement>) {\n    super();\n    this.entitySheet = entitySheet;\n    this.anchor = anchor;\n\n    const targetRect = anchor.get()[0].getBoundingClientRect();\n    const bodyRect = document.body.getBoundingClientRect();\n    const top = bodyRect.top + targetRect.top;\n\n    this.spawnCSS = {\n      left: targetRect.left - 280,\n      bottom: bodyRect.height - top - 23,\n      width: 300,\n      maxHeight: top + 23,\n    };\n  }\n  onSubmit(item: SearchItem): void {\n    fromUuid(item.uuid).then(e => {\n      if (isNewerVersion(game.data.version, \"0.6.9\")) {\n        //@ts-ignore\n        return this.entitySheet._onDropItemCreate(e);\n      }\n      this.entitySheet.entity.createEmbeddedEntity(\"OwnedItem\", e);\n    });\n  }\n}\n\nexport function identifyContext(target: Element): SearchContext {\n  if (target && isTextInputElement(target)) {\n    if (target.name === \"command\") {\n      if (\n        (target\n          .closest(\".macro-sheet\")\n          .querySelector('select[name=\"type\"]') as HTMLSelectElement).value ===\n        \"script\"\n      ) {\n        return new ScriptMacroContext(target);\n      }\n      return new InputContext(target);\n    } else if (\n      target.name.startsWith(\"results.\") &&\n      target.closest(\".result-details\")\n    ) {\n      return new RollTableContext(target);\n    }\n\n    // Right now, only allow in chat!\n    if (target.id === \"chat-message\") {\n      return new InputContext(target);\n    }\n  }\n\n  // No/unknown context, browse only.\n  if (getSetting(settings.ENABLE_GLOBAL_CONTEXT) === true) {\n    return new SearchContext();\n  }\n  return null;\n}\n\nexport class EmbeddedContext extends SearchContext {\n  spawnCSS = {\n    top: \"unset\",\n    left: \"0\",\n    bottom: \"0\",\n    \"max-height\": \"100%\",\n    width: \"100%\",\n    \"box-shadow\": \"none\",\n  };\n  onSubmit(): void {\n    return;\n  }\n}\n","import { SearchLib, SearchResult, packEnabled } from \"./searchLib\";\nimport type { SearchApp } from \"./searchApp\";\nimport type { SearchFilterCollection } from \"./searchFilters\";\nimport type { SearchContext } from \"./contexts\";\nimport type { SystemIntegration } from \"./systemIntegration\";\nimport { TimeoutError, withDeadline } from \"./utils\";\n\n// Module singleton class that contains everything\nclass QuickInsertCore {\n  app: SearchApp;\n  searchLib: SearchLib;\n  filters: SearchFilterCollection;\n  systemIntegration: SystemIntegration;\n\n  open(context?: SearchContext): void {\n    this.app.render(true, { context });\n  }\n\n  search(text: string, filter = null, max = 100): SearchResult[] {\n    return this.searchLib.search(text, filter, max);\n  }\n\n  async forceIndex(): Promise<void> {\n    return loadSearchIndex(true);\n  }\n}\n\nexport const QuickInsert = new QuickInsertCore();\n\n// Ensure that all compendiums have an index.\n// If you don't worry about staleness call it with refresh = false\nasync function preloadCompendiumIndexes(\n  refresh: boolean\n): Promise<{ [collection: string]: any }> {\n  const failures: { [collection: string]: any } = {};\n\n  for (const pack of game.packs as any) {\n    if (!packEnabled(pack)) {\n      continue;\n    }\n    if (refresh || pack.index.length === 0) {\n      try {\n        await withDeadline(pack.getIndex(), 1500);\n      } catch (error) {\n        console.warn(\n          `Failed to get index for compendium [\"${pack.metadata.label}\" - ${pack.collection}], reason:`,\n          error.message || error\n        );\n        failures[pack.collection] = error;\n      }\n    }\n  }\n  return failures;\n}\n\n// Ensure that only one loadSearchIndex function is running at any one time.\nlet isLoading = false;\n\nexport async function loadSearchIndex(refresh: boolean): Promise<void> {\n  if (isLoading) return;\n  isLoading = true;\n  console.log(\"Quick Insert | Preparing search index...\");\n  const start = performance.now();\n  QuickInsert.searchLib = new SearchLib();\n  QuickInsert.searchLib.indexDefaults();\n\n  for (let attemptsLeft = 5; attemptsLeft > 0; attemptsLeft--) {\n    const failures = await preloadCompendiumIndexes(refresh);\n    if (Object.entries(failures).length == 0) break;\n\n    const nonTimeoutFailures = Object.keys(failures).some(\n      p => !(failures[p] instanceof TimeoutError)\n    );\n\n    if (!nonTimeoutFailures) {\n      // Only timeouts, give up\n      break;\n    }\n    console.warn(\n      `Quick Insert | Failed to load compendium indexes, retrying in 2 seconds (retries left: ${attemptsLeft})`,\n      failures\n    );\n    refresh = true;\n    await new Promise(r => setTimeout(r, 2000));\n  }\n\n  console.log(\"Quick Insert | Pre-loaded compendium indexes\");\n\n  QuickInsert.searchLib.indexCompendiums();\n\n  QuickInsert.filters.resetFilters();\n  QuickInsert.filters.loadDefaultFilters();\n  QuickInsert.filters.loadSave();\n  console.log(\n    `Quick Insert | Search index and filters completed. Indexed ${\n      // @ts-ignore\n      QuickInsert.searchLib?.index?.fuse._docs.length || 0\n    } items in ${performance.now() - start}ms`\n  );\n\n  isLoading = false;\n}\n","import { EmbeddedContext } from \"./contexts\";\nimport { SearchFilter, SearchFilterConfig, FilterType } from \"./searchFilters\";\nimport { QuickInsert } from \"./core\";\nimport { enabledEntityTypes, packEnabled } from \"./searchLib\";\nimport { i18n } from \"./utils\";\n\nexport function parseFilterConfig(collections: string[]): SearchFilterConfig {\n  const filters: SearchFilterConfig = {\n    folders: [],\n    compendiums: [],\n    entities: [],\n  };\n\n  for (const coll of collections) {\n    const x = coll.indexOf(\".\");\n    const base = coll.slice(0, x);\n    const rest = coll.slice(x + 1);\n\n    if (base === \"Folder\") {\n      if (rest === \"Any\") {\n        filters.folders = \"any\";\n      } else if (!(typeof filters.folders === \"string\")) {\n        filters.folders.push(rest);\n      }\n    } else if (base === \"Compendium\") {\n      if (rest === \"Any\") {\n        filters.compendiums = \"any\";\n      } else if (!(typeof filters.compendiums === \"string\")) {\n        filters.compendiums.push(rest);\n      }\n    } else if (base === \"Entity\") {\n      if (rest === \"Any\") {\n        filters.entities = \"any\";\n      } else if (!(typeof filters.entities === \"string\")) {\n        filters.entities.push(rest);\n      }\n    }\n  }\n  return filters;\n}\n\nexport class FilterEditor extends Application {\n  get element(): JQuery<HTMLElement> {\n    return super.element as JQuery<HTMLElement>;\n  }\n  filter: SearchFilter;\n  searchInput: string;\n\n  idPrefix: RegExp;\n\n  constructor(filter: SearchFilter) {\n    super({\n      title: i18n(\"FilterEditorTitle\"),\n      classes: [\"filter-editor\"],\n      template: \"modules/quick-insert/templates/filter-editor.hbs\",\n      resizable: true,\n      width: 550,\n      height: 560,\n      scrollY: [\n        \".collection-list.compendium-list\",\n        \".collection-list.directory-list\",\n        \".collection-list.entity-list\",\n      ],\n    });\n    this.filter = filter;\n    this.idPrefix = new RegExp(`^${this.filter.id}_`);\n  }\n\n  prefix(name: string): string {\n    return `${this.filter.id}_${name}`;\n  }\n  unPrefix(name: string): string {\n    return name.replace(this.idPrefix, \"\");\n  }\n\n  render(force?: boolean, options?: RenderOptions): Application {\n    return super.render(force, options);\n  }\n\n  isEditable(): boolean {\n    return (\n      this.filter.type == FilterType.Client ||\n      (this.filter.type == FilterType.World && game.user.isGM)\n    );\n  }\n\n  fixAny(\n    type: string,\n    form: JQuery<HTMLFormElement>,\n    formData: JQuery.NameValuePair[]\n  ): void {\n    form\n      .find(`input[name^=\"${this.filter.id}_${type}.\"].disabled`)\n      .removeClass(\"disabled\");\n\n    const selectedAny = formData.find(r => r.name.endsWith(\".Any\"));\n    if (selectedAny) {\n      const other = form.find(\n        `input[name^=\"${this.filter.id}_${type}.\"]:not(input[name=\"${this.filter.id}_${selectedAny.name}\"])`\n      );\n      other.prop(\"checked\", false);\n      other.addClass(\"disabled\");\n    }\n  }\n\n  close(): Promise<void> {\n    if (this.element.find(\".quick-insert\").length > 0) {\n      QuickInsert.app.embeddedMode = false;\n      QuickInsert.app.closeDialog();\n    }\n\n    return super.close();\n  }\n\n  processForm(): {\n    name: string;\n    title: string;\n    formData: JQuery.NameValuePair[];\n  } {\n    const form = this.element.find(\"form\");\n\n    let formData = form.serializeArray();\n    formData.forEach(d => {\n      d.name = this.unPrefix(d.name);\n    });\n\n    const name = formData.find(p => p.name == \"name\").value.trim();\n    const title = formData.find(p => p.name == \"title\").value;\n    formData = formData.filter(p => p.name != \"name\" && p.name != \"title\");\n    const compendiums = formData.filter(r => r.name.startsWith(\"Compendium.\"));\n    const folders = formData.filter(r => r.name.startsWith(\"Folder.\"));\n    const entity = formData.filter(r => r.name.startsWith(\"Entity.\"));\n\n    this.fixAny(\"Compendium\", form, compendiums);\n    this.fixAny(\"Folder\", form, folders);\n    this.fixAny(\"Entity\", form, entity);\n\n    return {\n      name,\n      title,\n      formData,\n    };\n  }\n\n  formChange(): void {\n    if (!this.isEditable()) return;\n\n    const { name, title, formData } = this.processForm();\n\n    const config = parseFilterConfig(formData.map(x => x.name));\n    const oldTag = this.filter.tag;\n\n    if (name != \"\") {\n      this.filter.tag = name;\n    }\n\n    this.filter.subTitle = title;\n    this.filter.filterConfig = config;\n\n    // Hacky way to keep/update state of input\n    this.searchInput = QuickInsert.app.input\n      .text()\n      .replace(`@${oldTag}`, \"\")\n      .trim();\n\n    QuickInsert.filters.filtersChanged(this.filter.type);\n  }\n\n  attachQuickInsert(): void {\n    const context = new EmbeddedContext();\n    context.filter = this.filter;\n    context.startText = this.searchInput;\n\n    if (QuickInsert.app.embeddedMode) {\n      this.element.find(\".example-out\").append(QuickInsert.app.element);\n    } else {\n      Hooks.once(`render${QuickInsert.app.constructor.name}`, app => {\n        this.element.find(\".example-out\").append(app.element);\n      });\n    }\n\n    QuickInsert.app.embeddedMode = true;\n    QuickInsert.app.render(true, { context });\n  }\n\n  activateListeners(): void {\n    this.attachQuickInsert();\n    const form = this.element.find(\"form\");\n    form.change(() => {\n      this.formChange();\n    });\n    this.processForm();\n    if (\n      this.filter.type == FilterType.Default ||\n      (this.filter.type == FilterType.World && !game.user.isGM)\n    ) {\n      this.element.find(\"input\").prop(\"disabled\", true);\n    }\n    this.element.find(\".open-here\").on(\"click\", evt => {\n      evt.preventDefault();\n      this.attachQuickInsert();\n    });\n  }\n\n  getData(): any {\n    let folders = [];\n\n    if (game.user.isGM) {\n      folders = game.folders.map(folder => ({\n        label: folder.name,\n        name: this.prefix(`Folder.${folder._id}`),\n        selected: this.filter.filterConfig.folders.includes(folder._id),\n      }));\n    }\n\n    return {\n      tag: this.filter.tag,\n      subTitle: this.filter.subTitle,\n      isDefault: this.filter.type === FilterType.Default,\n      forbiddenWorld: this.filter.type == FilterType.World && !game.user.isGM,\n      collections: [\n        {\n          name: this.prefix(\"Compendium.Any\"),\n          label: i18n(\"FilterEditorCompendiumAny\"),\n          selected: this.filter.filterConfig.compendiums === \"any\",\n        },\n        ...game.packs\n          .filter(pack => packEnabled(pack))\n          .map(pack => ({\n            name: this.prefix(`Compendium.${pack.collection}`),\n            label: `${pack.metadata.label} - ${pack.collection}`,\n            selected: this.filter.filterConfig.compendiums.includes(\n              pack.collection\n            ),\n          })),\n      ],\n      entityTypes: [\n        {\n          name: this.prefix(\"Entity.Any\"),\n          label: i18n(\"FilterEditorEntityAny\"),\n          selected: this.filter.filterConfig.entities === \"any\",\n        },\n        ...enabledEntityTypes().map(type => ({\n          name: this.prefix(`Entity.${type}`),\n          label: game.i18n.localize(`ENTITY.${type}`),\n          selected: this.filter.filterConfig.entities.includes(type),\n        })),\n      ],\n      folders: [\n        {\n          name: this.prefix(\"Folder.Any\"),\n          label: i18n(\"FilterEditorFolderAny\"),\n          selected: this.filter.filterConfig.folders === \"any\",\n        },\n        ...folders,\n      ],\n    };\n  }\n}\n","import { FilterType, SearchFilter, SearchFilterConfig } from \"./searchFilters\";\nimport { i18n, randomId } from \"./utils\";\nimport { FilterEditor } from \"./filterEditor\";\n\nimport { QuickInsert } from \"./core\";\n\nconst typeIcons = {\n  [FilterType.Default]: `<i class=\"fas fa-lock\" title=\"Default filter\"></i>`,\n  [FilterType.World]: `<i class=\"fas fa-globe\" title=\"World filter\"></i>`,\n  [FilterType.Client]: `<i class=\"fas fa-user\" title=\"Client filter\"></i>`,\n};\n\nfunction cloneFilterConfig(original: SearchFilterConfig): SearchFilterConfig {\n  const res: SearchFilterConfig = {\n    compendiums: \"any\",\n    folders: \"any\",\n    entities: \"any\",\n  };\n\n  if (typeof original.compendiums !== \"string\") {\n    res.compendiums = [...original.compendiums];\n  }\n  if (typeof original.folders !== \"string\") {\n    res.folders = [...original.folders];\n  }\n  if (typeof original.entities !== \"string\") {\n    res.entities = [...original.entities];\n  }\n\n  return res;\n}\n\nexport class FilterList extends FormApplication {\n  _state: number;\n\n  get element(): JQuery<HTMLElement> {\n    return super.element as JQuery<HTMLElement>;\n  }\n\n  editors: { [key: string]: FilterEditor } = {};\n\n  constructor(object, options = {}) {\n    super(object, options);\n  }\n\n  static get defaultOptions(): ApplicationOptions {\n    return {\n      ...super.defaultOptions,\n      title: i18n(\"FilterListTitle\"),\n      id: \"filter-list\",\n      template: \"modules/quick-insert/templates/filter-list.hbs\",\n      resizable: true,\n      height: 500,\n      width: 350,\n      scrollY: [\".table-container\"],\n    };\n  }\n\n  getData(): any {\n    return {\n      filters: [\n        ...QuickInsert.filters.filters.map(filter => ({\n          id: filter.id,\n          icon: typeIcons[filter.type],\n          tag: filter.tag,\n          subTitle: filter.subTitle,\n          disabled: filter.disabled,\n          deletable:\n            filter.type == FilterType.Client ||\n            (filter.type == FilterType.World && game.user.isGM),\n        })),\n      ],\n    };\n  }\n\n  onFiltersUpdated = (): void => {\n    this.render(true);\n    Object.entries(this.editors).forEach(([id, editor]) => {\n      editor.filter = QuickInsert.filters.getFilter(id);\n      editor.rendered && editor.render(true);\n    });\n  };\n\n  render(...arg): Application {\n    if (this._state <= 0) {\n      Hooks.on(\"QuickInsert:FiltersUpdated\", this.onFiltersUpdated);\n    }\n    return super.render(...arg);\n  }\n\n  close(): Promise<void> {\n    Hooks.off(\"QuickInsert:FiltersUpdated\", this.onFiltersUpdated);\n    return super.close();\n  }\n\n  activateListeners(): void {\n    this.element.find(\".create-filter\").on(\"click\", () => {\n      this.newFilter();\n    });\n\n    this.element.find(\"i.delete\").on(\"click\", evt => {\n      const id = evt.target.closest(\"tr\").dataset[\"id\"];\n      QuickInsert.filters.deleteFilter(id);\n    });\n\n    this.element.find(\"i.edit\").on(\"click\", evt => {\n      const id = evt.target.closest(\"tr\").dataset[\"id\"];\n      this.editFilter(id);\n    });\n\n    this.element.find(\"i.duplicate\").on(\"click\", evt => {\n      const id = evt.target.closest(\"tr\").dataset[\"id\"];\n      this.newFilter(QuickInsert.filters.filters.find(f => f.id === id));\n    });\n\n    this.element.find(\"i.enable\").on(\"click\", evt => {\n      const id = evt.target.closest(\"tr\").dataset[\"id\"];\n      QuickInsert.filters.filters.find(f => f.id === id).disabled = false;\n      QuickInsert.filters.filtersChanged(FilterType.Client);\n    });\n\n    this.element.find(\"i.disable\").on(\"click\", evt => {\n      const id = evt.target.closest(\"tr\").dataset[\"id\"];\n      QuickInsert.filters.filters.find(f => f.id === id).disabled = true;\n      QuickInsert.filters.filtersChanged(FilterType.Client);\n    });\n  }\n\n  editFilter(id: string): void {\n    if (!this.editors[id]) {\n      this.editors[id] = new FilterEditor(\n        QuickInsert.filters.filters.find(f => f.id === id)\n      );\n    }\n\n    this.editors[id].render(true);\n  }\n\n  newFilter(original?: SearchFilter): void {\n    const scope = `\n  <p>\n    <label>${i18n(\"FilterListFilterScope\")}</label>\n    <select>\n      <option value=\"world\">${i18n(\"FilterListFilterScopeWorld\")}</option>\n      <option value=\"client\">${i18n(\"FilterListFilterScopeClient\")}</option>\n    </select>\n  </p>`;\n    const newDialog = new Dialog({\n      title: original\n        ? i18n(\"FilterListDuplicateFilterTitle\", { original: original.tag })\n        : i18n(\"FilterListNewFilterTitle\"),\n      content: `\n  <div class=\"new-filter-name\">\n    @<input type=\"text\" name=\"name\" id=\"name\" value=\"\" placeholder=\"${i18n(\n      \"FilterListFilterTagPlaceholder\"\n    )}\" pattern=\"[A-Za-z0-9\\\\._-]+\" minlength=\"1\">\n  </div>\n  ${game.user.isGM ? scope : \"\"}\n`,\n      buttons: {\n        apply: {\n          icon: \"<i class='fas fa-plus'></i>\",\n          label: i18n(\"FilterListCreateFilter\"),\n          callback: async (html: JQuery<HTMLElement>): Promise<void> => {\n            const input = html.find(\"input\");\n            const val = html.find(\"input\").val() as string;\n            const selected = html.find(\"select\").val();\n            if (input.get(0).checkValidity() && val !== \"\") {\n              this.createFilter(\n                val,\n                selected === \"world\" ? FilterType.World : FilterType.Client,\n                original\n              );\n            } else {\n              ui.notifications.error(`Incorrect filter tag: \"${val}\"`);\n            }\n          },\n        },\n      },\n      default: \"apply\",\n      close: (): void => {\n        return;\n      },\n    });\n    newDialog.render(true);\n  }\n\n  createFilter(tag: string, scope: FilterType, original?: SearchFilter): void {\n    const newId = randomId(30);\n\n    if (original) {\n      QuickInsert.filters.addFilter({\n        id: newId,\n        type: scope,\n        tag,\n        subTitle: `${original.subTitle} (Copy)`,\n        filterConfig: cloneFilterConfig(original.filterConfig),\n      });\n      return;\n    } else {\n      QuickInsert.filters.addFilter({\n        id: newId,\n        type: scope,\n        tag,\n        subTitle: tag,\n        filterConfig: {\n          compendiums: [],\n          folders: [],\n          entities: \"any\",\n        },\n      });\n    }\n    if (scope == FilterType.Client) {\n      this.editFilter(newId);\n    } else {\n      Hooks.once(\"QuickInsert:FiltersUpdated\", () => this.editFilter(newId));\n    }\n  }\n}\n","import { QuickInsert } from \"./core\";\nimport { settings, getSetting, setSetting } from \"./settings\";\nimport { i18n } from \"./utils\";\n\nexport class SheetFilters extends FormApplication {\n  _state: number;\n\n  get element(): JQuery<HTMLElement> {\n    return super.element as JQuery<HTMLElement>;\n  }\n\n  static get defaultOptions(): FormApplicationOptions {\n    return {\n      ...super.defaultOptions,\n      title: i18n(\"SheetFiltersTitle\"),\n      id: \"sheet-filters\",\n      template: \"modules/quick-insert/templates/sheet-filters.hbs\",\n      resizable: true,\n    };\n  }\n\n  getData(): any {\n    const filters = QuickInsert.filters.filters;\n    const customFilters = getSetting(settings.FILTERS_SHEETS).baseFilters;\n\n    return {\n      filters: Object.entries(customFilters).map(([key, filter]) => ({\n        key,\n        noFilter: filter === \"\",\n        options: filters.map(f => ({\n          ...f,\n          selected: filter === f.tag || filter === f.id,\n        })),\n      })),\n    };\n  }\n\n  activateListeners(html: JQuery<HTMLElement>): void {\n    super.activateListeners(html);\n  }\n\n  async _updateObject(event, formData): Promise<void> {\n    setSetting(settings.FILTERS_SHEETS, {\n      baseFilters: formData,\n    });\n  }\n}\n","export interface SystemIntegration {\n  id: string;\n  init(): void;\n  defaultSheetFilters?: { [key: string]: string };\n}\n\nexport async function importSystemIntegration(): Promise<SystemIntegration> {\n  let system = null;\n  switch (game.system.id) {\n    case \"dnd5e\":\n      system = await import(\"../systems/dnd5e\");\n      break;\n    case \"pf2e\":\n      system = await import(\"../systems/pf2e\");\n      break;\n    case \"swade\":\n      system = await import(\"../systems/swade\");\n      break;\n    case \"wfrp4e\":\n      system = await import(\"../systems/wfrp4e\");\n      break;\n    case \"sfrpg\":\n      system = await import(\"../systems/sfrpg\");\n      break;\n    default:\n      return null;\n  }\n\n  return {\n    id: game.system.id,\n    ...system,\n  };\n}\n","import { settings, getSetting } from \"./settings\";\nimport { TinyMCEContext } from \"./contexts\";\nimport { QuickInsert } from \"./core\";\n\nexport function registerTinyMCEPlugin(): void {\n  // TinyMCE addon registration\n  tinymce.PluginManager.add(\"quickinsert\", function (editor) {\n    editor.on(\"keydown\", evt => {\n      if (QuickInsert.app.embeddedMode) return;\n      let keySetting = getSetting(settings.QUICKOPEN);\n      // keybinds ending with space are trimmed by 0.7.x settings window\n      if (keySetting.endsWith(\"+\")) {\n        keySetting = keySetting + \"  \";\n      }\n\n      const key = window.Azzu.SettingsTypes.KeyBinding.parse(keySetting);\n      if (window.Azzu.SettingsTypes.KeyBinding.eventIsForBinding(evt, key)) {\n        evt.stopPropagation();\n        evt.preventDefault();\n        const context = new TinyMCEContext(editor);\n        context.startText = editor.selection.getContent().trim();\n        QuickInsert.open(context);\n      }\n    });\n    editor.ui.registry.addButton(\"quickinsert\", {\n      tooltip: \"Quick Insert\",\n      icon: \"search\",\n      onAction: function () {\n        if (QuickInsert.app.embeddedMode) return;\n        // Open window\n        QuickInsert.open(new TinyMCEContext(editor));\n      },\n    });\n  });\n  CONFIG.TinyMCE.plugins = CONFIG.TinyMCE.plugins + \" quickinsert\";\n  CONFIG.TinyMCE.toolbar = CONFIG.TinyMCE.toolbar + \" quickinsert\";\n}\n","import { settings, getSetting } from \"./settings\";\nimport { SearchResult, formatMatch } from \"./searchLib\";\nimport { SearchFilter, matchFilterConfig } from \"./searchFilters\";\n\nimport { identifyContext, SearchContext } from \"./contexts\";\n\nimport { placeCaretAtEnd } from \"./utils\";\nimport { loadSearchIndex, QuickInsert } from \"./core\";\n\nabstract class SearchMode {\n  app: SearchApp;\n  constructor(app: SearchApp) {\n    this.app = app;\n  }\n\n  abstract onTab(index: number): void;\n  abstract onEnter(index: number, evt?: JQuery.UIEventBase): void;\n  abstract onClick(index: number, evt?: JQuery.UIEventBase): void;\n  abstract search(textInput: string): string;\n}\n\nclass SearchEntitiesMode extends SearchMode {\n  results: SearchResult[];\n  onTab(index: number): void {\n    void index;\n    return;\n    // TODO: What is appropriate?\n  }\n\n  onEnter(index: number, evt: JQuery.UIEventBase): void {\n    this.app.attachedContext.onSubmit?.(this.results[index].item);\n    if (this.app.attachedContext.allowMultiple === false || !evt.shiftKey) {\n      this.app.closeDialog();\n    } else {\n      this.app.resetInput();\n    }\n  }\n\n  onClick(index: number, evt?: JQuery.UIEventBase): void {\n    if (getSetting(settings.CLICK_TO_INSERT) === true) {\n      this.onEnter(index, evt);\n    } else {\n      this.results[index].item.show();\n      this.app.focusInput();\n    }\n  }\n\n  search = (textInput: string): string => {\n    if (!QuickInsert.searchLib) return;\n\n    textInput = textInput.trim();\n    if (textInput.length == 0) {\n      return \"\";\n    }\n    // Set a lower maximum if search is single char (single-character search is fast, but rendering is slow).\n    const max = textInput.length == 1 ? 20 : 100;\n    if (this.app.selectedFilter) {\n      if (this.app.selectedFilter.filterConfig) {\n        this.results = QuickInsert.searchLib.search(\n          textInput,\n          item => matchFilterConfig(this.app.selectedFilter.filterConfig, item),\n          max\n        );\n      }\n    } else {\n      this.results = QuickInsert.searchLib.search(textInput, undefined, max);\n    }\n\n    if (\n      this.app.attachedContext.restrictTypes &&\n      this.app.attachedContext.restrictTypes.length > 0\n    ) {\n      this.results = this.results.filter(i =>\n        this.app.attachedContext.restrictTypes.includes(i.item.entityType)\n      );\n    }\n\n    return this.results\n      .map((res: SearchResult, i) => {\n        const icon = res.item.img\n          ? `<img src=\"${res.item.img}\" />`\n          : res.item.icon;\n        const formattedName = formatMatch(\n          res,\n          str => `<strong>${str}</strong>`\n        );\n\n        return (\n          `<li data-idx=\"${i}\"><a class=\"entity-link\" ${res.item.draggableAttrs} title=\"${res.item.name}, ${res.item.tagline}\">` +\n          `${icon}<span class=\"title\"> ${formattedName}</span><span class=\"sub\">${res.item.tagline}</span></a></li>`\n        );\n      })\n      .join(\"\");\n  };\n}\n\nclass SearchFiltersMode extends SearchMode {\n  filteredFilters: SearchFilter[] = [];\n\n  constructor(app) {\n    super(app);\n  }\n\n  onTab(index: number): void {\n    this.onEnter(index);\n  }\n\n  onEnter(index: number): void {\n    this.selectFilter(this.filteredFilters[index]);\n  }\n\n  selectFilter(filter: SearchFilter): void {\n    this.app.setFilterTag(filter);\n    this.app.selectedFilter = filter;\n    this.app.showResults(\n      `<li class=\"search-placeholder\">Searching: ${filter.subTitle}</li>`\n    );\n  }\n\n  onClick(index: number): void {\n    this.onEnter(index);\n    this.app.focusInput();\n  }\n\n  search(textInput: string): string {\n    const cleanedInput = textInput.toLowerCase().trim();\n    if (/\\s$/g.test(textInput)) {\n      // User has added a space after tag -> selected\n      const matchingFilter = QuickInsert.filters.getFilterByTag(cleanedInput);\n      if (matchingFilter) {\n        this.selectFilter(matchingFilter);\n        return;\n      }\n    }\n    this.filteredFilters = QuickInsert.filters.filters\n      .filter(f => !f.disabled)\n      .filter(f => f.tag.includes(cleanedInput));\n\n    return this.filteredFilters\n      .map(\n        (res, i) =>\n          `<li data-idx=\"${i}\"><a><span class=\"title\">@${res.tag}</span><span class=\"sub\">${res.subTitle}</span></a></li>`\n      )\n      .join(\"\");\n  }\n}\n\nenum ActiveMode {\n  Search = 1,\n  Filter,\n}\n\nexport class SearchApp extends Application {\n  debug = false;\n  _state: number;\n  mouseFocus = false;\n  inputFocus = false;\n  mode: ActiveMode = ActiveMode.Search;\n  selectedFilter: SearchFilter = null;\n  attachedContext: SearchContext;\n  selectedIndex = -1;\n  embeddedMode = false;\n\n  searchFiltersMode = new SearchFiltersMode(this);\n  searchEntitiesMode = new SearchEntitiesMode(this);\n\n  input: JQuery<HTMLElement>;\n  output: JQuery<HTMLElement>;\n\n  public get searchMode(): SearchMode {\n    if (this.mode === ActiveMode.Filter) {\n      return this.searchFiltersMode;\n    } else if (this.mode === ActiveMode.Search) {\n      return this.searchEntitiesMode;\n    }\n  }\n\n  constructor() {\n    super({\n      template: \"modules/quick-insert/templates/quick-insert.html\",\n      popOut: false,\n    });\n  }\n\n  resetInput(full = false): void {\n    if (!full && this.selectedFilter) {\n      this.setFilterTag(this.selectedFilter);\n    } else {\n      this.input.html(\"\");\n    }\n    this.focusInput();\n  }\n\n  selectNext(): void {\n    this.selectResult((this.selectedIndex + 1) % this.output.children().length);\n  }\n\n  selectPrevious(): void {\n    this.selectResult(\n      this.selectedIndex > 0\n        ? this.selectedIndex - 1\n        : this.output.children().length - 1\n    );\n  }\n\n  selectResult(resultIndex: number): void {\n    if (this.output.children().length === 0) {\n      this.selectedIndex = -1;\n      return;\n    }\n    this.selectedIndex = resultIndex;\n    this.output.find(\".search-selected\").removeClass(\"search-selected\");\n\n    const selected = $(this.output.children()[resultIndex]);\n    selected.addClass(\"search-selected\");\n\n    const list = $(this.element).find(\".quick-insert-result-wrapper\");\n\n    if (resultIndex === 0) {\n      // Just scroll to bottom\n      list.scrollTop(list.get(0).scrollHeight);\n      return;\n    }\n\n    // Bounding:\n    const listTop = list.offset().top;\n    const listBottom = listTop + list.height();\n\n    if (selected.offset().top < listTop) {\n      // Selected is above fold\n      list.scrollTop(selected.offset().top - listTop + list.scrollTop());\n    } else if (selected.offset().top + selected.height() > listBottom) {\n      // Selected is below fold\n      list.scrollTop(\n        selected.offset().top -\n          list.offset().top +\n          list.scrollTop() -\n          list.height() +\n          selected.outerHeight()\n      ); // This scrolls to the right one\n    }\n  }\n\n  setFilterTag(filter: SearchFilter): void {\n    const focus = this.input.is(\":focus\");\n\n    this.input.html(\"\");\n    const editable = this.embeddedMode ? `contenteditable=\"false\"` : \"\";\n    $(`<span class=\"search-tag\" ${editable}>@${filter.tag}</span>`).prependTo(\n      this.input\n    );\n    $('<span class=\"breaker\">&nbsp</span>').appendTo(this.input);\n    if (focus) {\n      this.focusInput();\n    }\n  }\n\n  closeDialog(): void {\n    if (this.embeddedMode) return;\n\n    this.attachedContext?.onClose?.();\n    this.selectedFilter = null;\n    this.close();\n  }\n\n  render(force: boolean, options?: { context: SearchContext }): Application {\n    if (options && options.context) {\n      this.attachedContext = options.context;\n      return super.render(force, options);\n    }\n\n    // Try to infer context\n    const target = document.activeElement;\n    this.attachedContext = identifyContext(target);\n\n    if (!this.attachedContext) {\n      return null;\n    }\n\n    return super.render(force, options);\n  }\n\n  showResults(searchContents: string): void {\n    this.output.html(searchContents);\n    this.output.on(\"click\", evt => {\n      evt.preventDefault();\n      evt.stopImmediatePropagation();\n      const id = evt.target.closest(\"li\").dataset.idx;\n      if (id) {\n        this.searchMode.onClick(parseInt(id), evt);\n      } else {\n        this.focusInput();\n      }\n    });\n    this.selectResult(0);\n  }\n\n  focusInput(): void {\n    placeCaretAtEnd(this.input.get(0));\n    this.inputFocus = true;\n  }\n\n  activateListeners(html: JQuery<HTMLElement>): void {\n    // (Re-)set position\n    html.removeAttr(\"style\");\n    if (this.attachedContext.spawnCSS) {\n      html.css(this.attachedContext.spawnCSS);\n    }\n    if (this.attachedContext.classes) {\n      html.addClass(this.attachedContext.classes);\n    }\n    this.input = html.find(\".search-editable-input\");\n    this.output = html.find(\".quick-insert-result\");\n\n    this.input.on(\"input\", () => {\n      this.searchInput();\n    });\n    this.input.on(\"dragstart\", evt => evt.stopPropagation());\n\n    const keyCodeBinds = {\n      13: this._onKeyEnter,\n      40: this._onKeyDown,\n      38: this._onKeyUp,\n      27: this._onKeyEsc,\n      9: this._onKeyTab,\n    };\n\n    this.input.on(\"keydown\", evt => {\n      if (keyCodeBinds[evt.which]) {\n        evt.preventDefault();\n        keyCodeBinds[evt.which](evt);\n      }\n    });\n\n    $(this.element).hover(\n      () => {\n        this.mouseFocus = true;\n        this._checkFocus();\n      },\n      e => {\n        if (e.originalEvent.shiftKey) return;\n        this.mouseFocus = false;\n        this._checkFocus();\n      }\n    );\n\n    $(this.element).on(\"focusout\", () => {\n      this.inputFocus = false;\n      this._checkFocus();\n    });\n\n    $(this.element).on(\"focusin\", () => {\n      this.inputFocus = true;\n      this._checkFocus();\n    });\n\n    this.focusInput();\n\n    if (this.attachedContext.filter) {\n      this.mode = ActiveMode.Filter;\n      if (typeof this.attachedContext.filter === \"string\") {\n        const found = QuickInsert.filters.getFilterByTag(\n          this.attachedContext.filter\n        );\n        if (found) {\n          this.searchFiltersMode.selectFilter(found);\n        }\n      } else {\n        this.searchFiltersMode.selectFilter(this.attachedContext.filter);\n      }\n    }\n\n    if (this.attachedContext.startText) {\n      this.input.append(this.attachedContext.startText);\n      this.focusInput();\n      this.searchInput();\n    }\n    if (!QuickInsert.searchLib) {\n      this.showResults(\n        `<li class=\"search-placeholder\"><i class=\"fas fa-spinner\"></i> Loading index...</li>`\n      );\n      loadSearchIndex(true)\n        .then(() => {\n          this.showResults(\n            `<li class=\"search-placeholder\">Index loaded successfully!</li>`\n          );\n        })\n        .catch(reason => {\n          this.showResults(\n            `<li class=\"search-placeholder\">Failed to load index ${reason}</li>`\n          );\n        });\n      // @ts-ignore\n    } else if (QuickInsert.searchLib?.index?.fuse._docs.length == 0) {\n      this.showResults(\n        `<li class=\"search-placeholder\">Search index is empty for some reason</li>`\n      );\n    }\n  }\n\n  searchInput(): void {\n    const text: string = this.input.text();\n    const breaker = $(this.input).find(\".breaker\");\n\n    if (this.selectedFilter) {\n      // Text was changed or breaker was removed\n      if (\n        !text.startsWith(`@${this.selectedFilter.tag}`) ||\n        breaker.length === 0 ||\n        breaker.is(\":empty\") ||\n        breaker.html() === \"<br>\"\n      ) {\n        if (this.embeddedMode) {\n          this.setFilterTag(this.selectedFilter);\n          return;\n        }\n        // Selectedfilter doesn't match any more :(\n        this.input.html(text);\n        this.focusInput();\n        this.selectedFilter = null;\n        this.mode = ActiveMode.Filter;\n        this.showResults(this.searchFiltersMode.search(text.substr(1).trim()));\n      } else {\n        this.mode = ActiveMode.Search;\n        const search = text.replace(`@${this.selectedFilter.tag}`, \"\").trim();\n        this.showResults(this.searchEntitiesMode.search(search));\n      }\n    } else if (text.startsWith(\"@\")) {\n      this.mode = ActiveMode.Filter;\n      this.showResults(this.searchFiltersMode.search(text.substr(1)));\n    } else {\n      this.mode = ActiveMode.Search;\n      this.showResults(this.searchEntitiesMode.search(text));\n    }\n  }\n\n  _checkFocus = (): void => {\n    if (this.debug || this.embeddedMode) return;\n\n    if (!this.mouseFocus && !this.inputFocus) {\n      this.closeDialog();\n    }\n  };\n  _onKeyTab = (): void =>\n    !this.embeddedMode && this.searchMode.onTab(this.selectedIndex);\n  _onKeyEsc = (evt: JQuery.UIEventBase): void => {\n    if (this.embeddedMode) return;\n    evt.preventDefault();\n    evt.stopPropagation();\n    this.closeDialog();\n  };\n  _onKeyDown = (): void => this.selectPrevious();\n  _onKeyUp = (): void => this.selectNext();\n  _onKeyEnter = (evt: JQuery.UIEventBase): void => {\n    if (this.selectedIndex > -1) {\n      this.searchMode.onEnter(this.selectedIndex, evt);\n    }\n  };\n}\n","import { IndexedEntityTypes } from \"./searchLib\";\nimport { settings, getSetting, setSetting } from \"./settings\";\nimport { i18n, permissionListEq } from \"./utils\";\n\nexport class IndexingSettings extends FormApplication {\n  _state: number;\n\n  get element(): JQuery<HTMLElement> {\n    return super.element as JQuery<HTMLElement>;\n  }\n\n  static get defaultOptions(): FormApplicationOptions {\n    return {\n      ...super.defaultOptions,\n      title: i18n(\"IndexingSettingsTitle\"),\n      id: \"indexing-settings\",\n      template: \"modules/quick-insert/templates/indexing-settings.hbs\",\n      resizable: true,\n      width: 660,\n    };\n  }\n\n  getData(): any {\n    const disabled = getSetting(settings.INDEXING_DISABLED);\n    return {\n      entityTypes: IndexedEntityTypes.map(type => ({\n        type,\n        title: `ENTITY.${type}`,\n        values: [1, 2, 3, 4].map(role => ({\n          role,\n          disabled: disabled?.entities?.[type]?.includes(role),\n        })),\n      })),\n      compendiums: [...game.packs.keys()].map(pack => ({\n        pack,\n        values: [1, 2, 3, 4].map(role => ({\n          role,\n          disabled: disabled?.packs?.[pack]?.includes(role),\n        })),\n      })),\n    };\n  }\n\n  activateListeners(html: JQuery<HTMLElement>): void {\n    super.activateListeners(html);\n    // Set initial state for all\n    const disabled = getSetting(settings.INDEXING_DISABLED);\n    Object.entries(disabled.packs).forEach(([pack, val]) => {\n      const check = html.find(`[data-disable=\"${pack}\"]`);\n      if (permissionListEq(val as [], [1, 2, 3, 4])) {\n        check.prop(\"checked\", false);\n      } else {\n        check.prop(\"indeterminate\", true);\n      }\n    });\n\n    // Root check change -> updates regular checks\n    (html.find(\"input.disable-pack\") as JQuery<HTMLInputElement>).on(\n      \"change\",\n      function () {\n        const compendium = this.dataset.disable;\n        html\n          .find(`input[name^=\"${compendium}.\"]`)\n          .prop(\"checked\", this.checked);\n      }\n    );\n\n    // Regular check change -> updates root check\n    (html.find(\".form-fields input\") as JQuery<HTMLInputElement>).on(\n      \"change\",\n      function () {\n        const compendium = this.name.slice(0, -2);\n        const checks = html.find(`input[name^=\"${compendium}.\"]`).toArray();\n        if (checks.every((e: HTMLInputElement) => e.checked)) {\n          html\n            .find(`[data-disable=\"${compendium}\"]`)\n            .prop(\"checked\", true)\n            .prop(\"indeterminate\", false);\n        } else if (checks.every((e: HTMLInputElement) => !e.checked)) {\n          html\n            .find(`[data-disable=\"${compendium}\"]`)\n            .prop(\"checked\", false)\n            .prop(\"indeterminate\", false);\n        } else {\n          html\n            .find(`[data-disable=\"${compendium}\"]`)\n            .prop(\n              \"checked\",\n              checks.some((e: HTMLInputElement) => e.checked)\n            )\n            .prop(\"indeterminate\", true);\n        }\n      }\n    );\n\n    // Deselect all button\n    html.find(\"button.deselect-all\").on(\"click\", e => {\n      e.preventDefault();\n      e.stopPropagation();\n      html\n        .find(`.form-group.pack input[type=\"checkbox\"]`)\n        .prop(\"checked\", false)\n        .prop(\"indeterminate\", false);\n    });\n    // Select all button\n    html.find(\"button.select-all\").on(\"click\", e => {\n      e.preventDefault();\n      e.stopPropagation();\n      html\n        .find(`.form-group.pack input[type=\"checkbox\"]`)\n        .prop(\"checked\", true)\n        .prop(\"indeterminate\", false);\n    });\n  }\n\n  async _updateObject(event, formData): Promise<void> {\n    const res: {\n      entities: {\n        [key: string]: number[];\n      };\n      packs: {\n        [key: string]: number[];\n      };\n    } = {\n      entities: {},\n      packs: {},\n    };\n\n    for (const [name, checked] of Object.entries(formData)) {\n      if (!checked) {\n        const [base, middle, last] = name.split(\".\");\n        if (last) {\n          const pack = `${base}.${middle}`;\n          res.packs[pack] = res.packs[pack] || [];\n          res.packs[pack].push(parseInt(last));\n        } else {\n          const type = base;\n          res.entities[type] = res.entities[type] || [];\n          res.entities[type].push(parseInt(middle));\n        }\n      }\n    }\n    setSetting(settings.INDEXING_DISABLED, res);\n  }\n}\n","import {\n  registerSettings,\n  settings,\n  getSetting,\n  registerMenu,\n} from \"./module/settings\";\nimport { EntitySearchItem, enabledEntityTypes } from \"./module/searchLib\";\n\nimport { FilterList } from \"./module/filterList\";\nimport { SheetFilters } from \"./module/sheetFilters\";\n\nimport { importSystemIntegration } from \"./module/systemIntegration\";\nimport { registerTinyMCEPlugin } from \"./module/tinyMCEPlugin\";\n\nimport { SearchApp } from \"./module/searchApp\";\nimport { QuickInsert, loadSearchIndex } from \"./module/core\";\nimport { SearchFilterCollection } from \"./module/searchFilters\";\nimport { IndexingSettings } from \"./module/indexingSettings\";\nimport { resolveAfter } from \"./module/utils\";\n\nfunction quickInsertDisabled(): boolean {\n  return !game.user.isGM && getSetting(settings.GM_ONLY);\n}\n\n// Client is currently reindexing?\nlet reIndexing = false;\n\nHooks.once(\"init\", async function () {\n  registerMenu({\n    menu: \"indexingSettings\",\n    name: \"QUICKINSERT.SettingsIndexingSettings\",\n    label: \"QUICKINSERT.SettingsIndexingSettingsLabel\",\n    icon: \"fas fa-search\",\n    type: IndexingSettings,\n  });\n  registerMenu({\n    menu: \"filterMenu\",\n    name: \"QUICKINSERT.SettingsFilterMenu\",\n    label: \"QUICKINSERT.SettingsFilterMenuLabel\",\n    icon: \"fas fa-filter\",\n    type: FilterList,\n  });\n  registerSettings({\n    [settings.FILTERS_WORLD]: () => {\n      if (quickInsertDisabled()) return;\n      QuickInsert.filters.loadSave();\n    },\n    [settings.FILTERS_CLIENT]: () => {\n      if (quickInsertDisabled()) return;\n      QuickInsert.filters.loadSave();\n    },\n    [settings.INDEXING_DISABLED]: async () => {\n      if (quickInsertDisabled()) return;\n      // Active users will start reindexing in deterministic order, once per 300ms\n\n      if (reIndexing) return;\n      reIndexing = true;\n      const order = [...game.users.entities]\n        .filter(u => u.active)\n        .map(u => u.id)\n        .indexOf(game.userId);\n      await resolveAfter(order * 300);\n      await QuickInsert.forceIndex();\n      reIndexing = false;\n    },\n    [settings.INDEX_GUARD_ENABLED]: val => {\n      if (quickInsertDisabled()) return;\n      if (val) {\n        localStorage.setItem(\"IndexGuardEnabled\", \"enabled\");\n      } else {\n        localStorage.removeItem(\"IndexGuardEnabled\");\n      }\n      window.location.reload();\n    },\n  });\n});\n\nHooks.once(\"ready\", function () {\n  if (quickInsertDisabled()) return;\n  console.log(\"Quick Insert | Initializing...\");\n\n  // Ensure index guard setting is synced with local storage.\n  if (getSetting(settings.INDEX_GUARD_ENABLED)) {\n    if (!localStorage.getItem(\"IndexGuardEnabled\")) {\n      localStorage.setItem(\"IndexGuardEnabled\", \"enabled\");\n    }\n  } else {\n    if (localStorage.getItem(\"IndexGuardEnabled\")) {\n      localStorage.removeItem(\"IndexGuardEnabled\");\n    }\n  }\n\n  // Initialize application base\n  QuickInsert.filters = new SearchFilterCollection();\n  QuickInsert.app = new SearchApp();\n\n  registerTinyMCEPlugin();\n\n  importSystemIntegration().then(systemIntegration => {\n    if (systemIntegration) {\n      QuickInsert.systemIntegration = systemIntegration;\n      QuickInsert.systemIntegration.init();\n\n      if (QuickInsert.systemIntegration.defaultSheetFilters) {\n        registerMenu({\n          menu: \"sheetFilters\",\n          name: \"QUICKINSERT.SettingsSheetFilters\",\n          label: \"QUICKINSERT.SettingsSheetFiltersLabel\",\n          icon: \"fas fa-filter\",\n          type: SheetFilters,\n        });\n      }\n    }\n  });\n\n  document.addEventListener(\"keydown\", evt => {\n    if (QuickInsert.app.embeddedMode || !evt) return;\n\n    let keySetting = getSetting(settings.QUICKOPEN);\n    // keybinds ending with space are trimmed by 0.7.x settings window\n    if (keySetting.endsWith(\"+\")) {\n      keySetting = keySetting + \"  \";\n    }\n\n    const key = window.Azzu.SettingsTypes.KeyBinding.parse(keySetting);\n    if (key.key === \" \" && canvas.controls?.ruler?.waypoints?.length > 0) {\n      return;\n    }\n    if (\n      window.Azzu.SettingsTypes.KeyBinding.eventIsForBinding(evt, key) &&\n      !$(document.activeElement)\n        .closest(\".app.window-app\")\n        .is(\"#client-settings\")\n    ) {\n      evt.stopPropagation();\n      evt.preventDefault();\n      QuickInsert.open();\n    }\n  });\n\n  enabledEntityTypes().forEach(type => {\n    Hooks.on(`create${type}`, entity => {\n      if (!entity.visible) return;\n      QuickInsert.searchLib?.addItem(new EntitySearchItem(entity));\n    });\n    Hooks.on(`update${type}`, entity => {\n      if (!entity.visible) {\n        QuickInsert.searchLib?.removeItem(entity.uuid);\n        return;\n      }\n      QuickInsert.searchLib?.replaceItem(new EntitySearchItem(entity));\n    });\n    Hooks.on(`delete${type}`, entity => {\n      QuickInsert.searchLib?.removeItem(entity.uuid);\n    });\n  });\n\n  console.log(\"Quick Insert | Search Application ready\");\n\n  const deferredDelay = getSetting(settings.INDEX_DEFERRED_DELAY);\n  if (deferredDelay != -1) {\n    setTimeout(() => {\n      loadSearchIndex(false);\n    }, getSetting(settings.INDEX_DEFERRED_DELAY));\n  }\n});\n\n// Exports and API usage\n\nglobalThis.QuickInsert = QuickInsert;\nexport { SearchContext } from \"./module/contexts\";\nexport { QuickInsert };\n"],"names":[],"mappings":"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"}